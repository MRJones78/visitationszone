language: python
python:
  - "2.7"
cache: pip
before_install:
  - openssl aes-256-cbc -K $encrypted_d78a7203a7b0_key -iv $encrypted_d78a7203a7b0_iv -in build/github_deploy_key.enc -out build/github_deploy_key -d
  - git config --global user.email "travis@travis-ci.org"
  - git config --global user.name "Travis CI"
  - git config --global push.default simple
  - git remote set-url origin git@github.com:christianpanton/visitationszone.git
install: "pip install -r requirements.txt"
script: python build/build.py
after_success:
  - |

        declare -r SSH_FILE="$(mktemp -u $HOME/.ssh/XXXXX)"

        # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

        # Decrypt the file containing the private key
        # (Note: this is the same as what is generated by the Travis CLI at step 2.5)

        openssl aes-256-cbc \
         -K $encrypted_d78a7203a7b0_key \
         -iv $encrypted_d78a7203a7b0_iv \
         -in "build/github_deploy_key.enc" \
         -out "$SSH_FILE" -d

        # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

        # Enable SSH authentication

        chmod 600 "$SSH_FILE" \
          && printf "%s\n" \
               "Host github.com" \
               "  IdentityFile $SSH_FILE" \
               "  LogLevel ERROR" >> ~/.ssh/config


  - git add zones/*
  - git add zones.json
  - git checkout master
  - git commit --message "Travis build $TRAVIS_BUILD_NUMBER"
  - git push origin master